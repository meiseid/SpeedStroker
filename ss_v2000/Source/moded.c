#include "drawctrl.h"#include "moded.h"#include "timectrl.h"#include "mondai.h"#include "appdata.h"#include "fade.h"extern HWND g_hWnd;static HFONT g_hFontOld; /* Work */static BYTE g_byCountDown = 5;static BOOL	g_bEndOfFade = FALSE;static TEXTFADE g_Ready;VOID StartModeD( BOOL bErase ){	g_Ready.rgbOrg.rgbRed = 0xFF; 	g_Ready.rgbOrg.rgbGreen = 0xFF;	g_Ready.rgbOrg.rgbBlue = 0xFF;	g_byCountDown = 5;	g_bEndOfFade = FALSE;	BeginTextFade( &g_Ready );	SwitchScreen( SS_MODED,bErase );	}BOOL ProcessModeD( VOID ){	FADESTATUS st;	if( !g_bEndOfFade ){		st = FadeTextFade( &g_Ready );		InvalidateRect( g_hWnd,GetRectangle( GR_MODED_READY ),FALSE );		if( st==FADE_INEND ){			g_bEndOfFade = TRUE;			EndTimer();			InitializeMondaiData();			StartTimerEx( ST_MODED,1000 );		}		return TRUE;	}	if( g_byCountDown == 2 )		PlayAppSound(PAS_GO);	else if( g_byCountDown >=3 && g_byCountDown <=5 )		PlayAppSound(PAS_COUNT);	if( g_byCountDown == 5 )		InvalidateRect( g_hWnd,GetRectangle( GR_MODED_COUNTDOWN ),FALSE );	else if( g_byCountDown < 5 )		InvalidateRect( g_hWnd,GetRectangle( GR_MODED_COUNTDOWN ),TRUE );			g_byCountDown--;		if( g_byCountDown == 0 )		return FALSE;			return TRUE;}VOID DrawModeD( HDC hDC ){	INT val;	 SELECTFONT( GetFont(GF_MODED_READY) );	 COLORTEXT( g_Ready.rgbNow.rgbRed,g_Ready.rgbNow.rgbGreen,g_Ready.rgbNow.rgbBlue );     DRAWTEXTCENTER( GetString( GS_MODED_READY ),GetRectangle(GR_MODED_READY) );	 RESTOREFONT();	 	val = g_byCountDown-1; 	 if( val >= 0 && val <= 3 ){	 	 SELECTFONT( GetFont(GF_MODED_COUNTDOWN) );	 	if( val >=1 )	 		COLORTEXT( 0xFF,0xFF,0x00 );	 	else	 		COLORTEXT( 0x00,0xFF,0x00 );	 	 	DRAWTEXTCENTER( GetString( GS_MODED_COUNTDOWN_GO+val ),	 					GetRectangle(GR_MODED_COUNTDOWN) );	  	RESTOREFONT();	 		 }}