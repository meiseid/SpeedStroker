#include "appdata.h"#include "filectrl.h"#include "char.h"#include <mmsystem.h> // For PlaySoundextern HWND g_hWnd;//Global Valiables//Fonts#define MAX_FONT	16static HFONT g_hFontArray[MAX_FONT];static INT		g_iFontHeightArray[MAX_FONT];//Pens#define MAX_PEN		2static HPEN g_hPenArray[MAX_PEN];//Rects#define MAX_RECT	53static RECT g_rcArray[MAX_RECT];//フェードイン／アウト型構造体static DIBFADE g_DIBFade;//Speed Stroke Text Arraystatic SSTA	g_SSTA;//Game Optionstatic GAMEOPTION g_GameOption;static BOOL g_bLoadOK;//Sounds#define MAX_SOUND	8static LPVOID	g_lpSoundArray[MAX_SOUND];//Stringsstatic LPSTR g_str[]={   "SpeedStroker",	//App Name    "システムエラーが発生しました。Windowsを再起動して、再び実行して下さい。",	    "メモリーが足りません。他のアプリケーションを終了し、再び実行して下さい。",    "データファイルがオープンできません。Dataフォルダ内のファイルを確認して下さい。",     "データファイルのフォーマットが不正です。",     "GOOD!",             "MISS!",                "TIME OVER!",        "CONGRATULATIONS!",         "GAME OVER",          "Random Select Strings",        "Clear Strings",        "Clear Percentage",     "Total Key Strokes",      "Miss Strokes",     "Good Stroke Percentage",      "KeyStroke Speed",    "Total Your Score",       "Press Any Key To Exit",     " Stroke/Seconds",    "SpeedStrokerWClass",       "0.0",       "0.00",       "%",    "A","B","C","D","E","F",    "Data\\sst\\sst.inf",    "Data\\wav\\ok.wav","Data\\wav\\ng.wav","Data\\wav\\good.wav",    "Data\\wav\\miss.wav","Data\\wav\\timeover.wav",    "Ready...","GO!!!","1","2","3",    "Press Return Key To Continue.",    "Or Escape Key To Exit.",    "ESC is GiveUp Game.",    "Data\\bmp\\startup.bmp",    "SSTROKERICON",    "Data\\wav\\count.wav","Data\\wav\\go.wav",    "GIVE UP!",    "GAME START",    "GAME OPTION",    "HIGH SCORES",    "EXIT APPLICATION",    "2001 - 2002 Copyright (c)",    "Shoma Sarashina",    "Stroke Selection",    "オールジャンル",    "すべてのジャンルからランダムに出題します。",    "Data\\wav\\giveup.wav",    "<<PREV",    "NEXT>>",    "Stroke Option",    "設定終了",    "▲",    "▼",    "０","１","２","３","４","５","６","７","８","９",    "出題数",    "問",    "<<TITLE",    "戻る",    "難易度",    "★",    "★★★★★★★★",    "EASY",    "HARD",    "Your Score Ranked in ",    "th! ",    "rd! ",    "nd! ",    "st! ",    "HIGH SCORE RANKING",    "音声",    "ON","OFF",    "ハイスコア",    "保存","破棄",    ".Default\\Software\\Sarashina\\SStroker",    "Option"    };//Static Function Prototypesstatic ERRCODE NewAppFont( VOID );static ERRCODE NewAppPen( VOID );static VOID SetAppRect( VOID );static ERRCODE LoadGameOption( VOID );static ERRCODE SaveGameOption( VOID );static VOID SetDefaultOption( VOID );static VOID SetDefaultScore( VOID );ERRCODE NewAppData( VOID ){	ERRCODE err;		g_bLoadOK = FALSE;#define ERET( e ) if( e != ERR_NOTHING ) return e	//必須データのセットアップ	err = NewAppFont();	ERET( err );		err = NewAppPen();	ERET( err );		err = NewDIBFade( GetString(GS_FNAME_LOGO),&g_DIBFade,NULL );	ERET( err );	err = NewSSTA( GetString(GS_FNAME_SSTINFO),&g_SSTA ); 	ERET( err );	err = LoadGameOption();	ERET( err );#undef ERET	SetAppRect();		//サウンドファイルの読み込み、なくてもエラーにはならない	ReadFileToMemory( GetString(GS_FNAME_OKWAV),&g_lpSoundArray[0] );	ReadFileToMemory( GetString(GS_FNAME_NGWAV),&g_lpSoundArray[1] );	ReadFileToMemory( GetString(GS_FNAME_GOODWAV),&g_lpSoundArray[2] );	ReadFileToMemory( GetString(GS_FNAME_MISSWAV),&g_lpSoundArray[3] );	ReadFileToMemory( GetString(GS_FNAME_TIMEOVERWAV),&g_lpSoundArray[4] );	ReadFileToMemory( GetString(GS_FNAME_COUNTWAV),&g_lpSoundArray[5] );	ReadFileToMemory( GetString(GS_FNAME_GOWAV),&g_lpSoundArray[6] );	ReadFileToMemory( GetString(GS_FNAME_GIVEUPWAV),&g_lpSoundArray[7] );	return ERR_NOTHING;}VOID DeleteAppData( VOID ){	INT i;	PlaySound( NULL,NULL,0 );			//レジストリに保存	SaveGameOption();	//Font	for( i=0;i<MAX_FONT;i++ ){		if( g_hFontArray[i] )			DeleteObject( g_hFontArray[i] );	}		//Pen	for( i=0;i<MAX_PEN;i++ ){		if( g_hPenArray[i] )			DeleteObject( g_hPenArray[i] );	}	//Sound	for( i=0;i<MAX_SOUND;i++ ){		if( g_lpSoundArray[i] )			GlobalFree( g_lpSoundArray[i] );	}	//SSTA	DeleteSSTA( &g_SSTA );		//DIBFade	DeleteDIBFade( &g_DIBFade );}VOID ErrorExit( ERRCODE uErrorID ){	  MessageBox( g_hWnd,GetString(uErrorID),GetString(GS_APPLICATION),   				MB_OK | MB_ICONSTOP );		  DestroyWindow( g_hWnd );}ERRCODE NewAppFont( VOID ){	HDC hDC;    	HFONT hfontOld;	TEXTMETRIC tm;    	PLOGFONT plf;    	INT i;	 //グローバルフォントの取得            hDC = GetDC( g_hWnd );            plf = (PLOGFONT) LocalAlloc(LPTR, sizeof(LOGFONT));	     if( !plf ){	     	return ERR_SYSTEM;	     }	     plf->lfHeight = -MulDiv(24, GetDeviceCaps(hDC, LOGPIXELSY), 72);            plf->lfWeight = FW_BOLD;            plf->lfCharSet = SHIFTJIS_CHARSET;            plf->lfFaceName[0]='\0';            g_hFontArray[GF_STROKE_STATIC] = CreateFontIndirect( plf );                        plf->lfHeight = -MulDiv(12, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_STROKE_INPUT] = CreateFontIndirect( plf );                        //For ModeC             plf->lfHeight = -MulDiv(12, GetDeviceCaps(hDC, LOGPIXELSY), 72);             g_hFontArray[GF_MODEC_C] = CreateFontIndirect( plf );            plf->lfHeight = -MulDiv(24, GetDeviceCaps(hDC, LOGPIXELSY), 72);            lstrcpy( plf->lfFaceName,"ＭＳ 明朝" );            g_hFontArray[GF_MODEC_B] = CreateFontIndirect( plf );            plf->lfHeight = -MulDiv(12, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_MSMIN_SMALL] = CreateFontIndirect( plf );                         plf->lfHeight = -MulDiv(24, GetDeviceCaps(hDC, LOGPIXELSY), 72);            plf->lfCharSet = DEFAULT_CHARSET;            lstrcpy( plf->lfFaceName,"Times New Roman" );            g_hFontArray[GF_STATUS] = CreateFontIndirect( plf );            g_hFontArray[GF_MODED_READY] = CreateFontIndirect( plf );            plf->lfHeight = -MulDiv(18, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_TIMES_SMALL] = CreateFontIndirect( plf );                                     plf->lfHeight = -MulDiv(24, GetDeviceCaps(hDC, LOGPIXELSY), 72);            lstrcpy( plf->lfFaceName,"Arial Black");            g_hFontArray[GF_SUMMANY_TITLE]=CreateFontIndirect( plf );            plf->lfHeight = -MulDiv(72, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_MODED_COUNTDOWN]=CreateFontIndirect( plf );            plf->lfHeight = -MulDiv(12, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_MODEB_GUIDE]=CreateFontIndirect( plf );                                               plf->lfHeight = -MulDiv(12, GetDeviceCaps(hDC, LOGPIXELSY), 72);            lstrcpy( plf->lfFaceName,"Arial" );            g_hFontArray[GF_SUMMANY_GUIDE]=CreateFontIndirect( plf );                        //For ModeA            lstrcpy( plf->lfFaceName,"Times New Roman" );            plf->lfHeight = -MulDiv(24, GetDeviceCaps(hDC, LOGPIXELSY), 72);            plf->lfItalic = 1; /* italic on */            g_hFontArray[GF_MODEA_YEAR] = CreateFontIndirect( plf );            g_hFontArray[GF_MODEC_D] = CreateFontIndirect( plf );                        lstrcpy( plf->lfFaceName,"Arial Black");            plf->lfHeight = -MulDiv(36, GetDeviceCaps(hDC, LOGPIXELSY), 72);            g_hFontArray[GF_MODEA_NAME] = CreateFontIndirect( plf );            g_hFontArray[GF_MODEC_A] = CreateFontIndirect( plf );                        LocalFree((HLOCAL) plf);                        //高さの設定            for( i =0;i<MAX_FONT;i++ ){            	//フォントがない場合、エラー            	if( g_hFontArray[i] == NULL ){            		return ERR_SYSTEM;            	}                      	hfontOld = SelectObject( hDC,g_hFontArray[i] );			GetTextMetrics( hDC,&tm );            		g_iFontHeightArray[i] = tm.tmHeight;            	SelectObject( hDC,hfontOld );            }                             ReleaseDC( g_hWnd,hDC );	return ERR_NOTHING;}HFONT	GetFont( UINT uFontID ){	return g_hFontArray[uFontID];}//static --- SetAppRectsのみが使うINT		GetFontHeight( UINT uFontID ){	return g_iFontHeightArray[uFontID];}ERRCODE NewAppPen( VOID ){	INT i;	 //グローバルペンの作成	 g_hPenArray[GP_WHITE]=CreatePen( PS_SOLID,1,RGB( 0xFF,0xFF,0xFF) );	 g_hPenArray[GP_YELLOW]=CreatePen( PS_SOLID,1,RGB( 0xFF,0xFF,0x00) );	 	 for( i=0;i<MAX_PEN;i++ ){	 	if( g_hPenArray[i] == NULL )	 		return ERR_SYSTEM;	}	return ERR_NOTHING;}HPEN	GetPen( UINT uPenID ){	return g_hPenArray[uPenID];}//RectsVOID SetAppRect( VOID ){	INT	i;	INT offx;	//フル画面 	GetClientRect( g_hWnd,&g_rcArray[GR_SCREEN] );            //物理フォントから領域情報をセットする    		//問題文領域            SetRect( &g_rcArray[GR_STROKE_STATIC],            		0,                    g_rcArray[GR_SCREEN].bottom/2-GetFontHeight(GF_STROKE_STATIC),                    g_rcArray[GR_SCREEN].right,                    g_rcArray[GR_SCREEN].bottom/2 );     		    		//タイピング領域            SetRect( &g_rcArray[GR_STROKE_INPUT],            		0,                    g_rcArray[GR_STROKE_STATIC].bottom+4,                    g_rcArray[GR_SCREEN].right,                    g_rcArray[GR_STROKE_STATIC].bottom+4+GetFontHeight(GF_STROKE_INPUT) );			SetRect( &g_rcArray[GR_STROKE],g_rcArray[GR_STROKE_STATIC].left,									  g_rcArray[GR_STROKE_STATIC].top,									  g_rcArray[GR_STROKE_INPUT].right,									  g_rcArray[GR_STROKE_INPUT].bottom	);		//進捗領域            SetRect( &g_rcArray[GR_PROGRESS],			g_rcArray[GR_SCREEN].left+10,			10,			g_rcArray[GR_SCREEN].right,			10+GetFontHeight(GF_SUMMANY_GUIDE) );						//Countdown領域            SetRect( &g_rcArray[GR_MODED_COUNTDOWN],            		0,                    g_rcArray[GR_STROKE_STATIC].top,                    g_rcArray[GR_SCREEN].right,                    g_rcArray[GR_STROKE_STATIC].top+GetFontHeight(GF_MODED_COUNTDOWN) );     		    		//Ready領域            SetRect( &g_rcArray[GR_MODED_READY],            		0,                    g_rcArray[GR_MODED_COUNTDOWN].top-GetFontHeight(GF_MODED_READY)-3,                    g_rcArray[GR_SCREEN].right,                    g_rcArray[GR_MODED_COUNTDOWN].top-3);			SetRect( &g_rcArray[GR_MODED],g_rcArray[GR_MODED_READY].left,									  g_rcArray[GR_MODED_READY].top,									  g_rcArray[GR_MODED_COUNTDOWN].right,									  g_rcArray[GR_MODED_COUNTDOWN].bottom	);						//ステータスメッセージ領域           	SetRect( &g_rcArray[GR_STATUS],            		0,                    g_rcArray[GR_SCREEN].bottom/2-(GetFontHeight(GF_STATUS)/2),                    g_rcArray[GR_SCREEN].right,                    g_rcArray[GR_SCREEN].bottom/2+(GetFontHeight(GF_STATUS)/2+GetFontHeight(GF_STATUS)%2) );                 							SetRect( &g_rcArray[GR_STROKE_GUIDE],			g_rcArray[GR_SCREEN].left,			g_rcArray[GR_SCREEN].bottom-GetFontHeight(GF_SUMMANY_GUIDE)-10,			g_rcArray[GR_SCREEN].right-10,			g_rcArray[GR_SCREEN].bottom-10 );				//ロゴ画面(画面の中央に配置する)		SetRect( &g_rcArray[GR_MODEB],				(g_rcArray[GR_SCREEN].right/2)-(g_DIBFade.dwWidth/2),				(g_rcArray[GR_SCREEN].bottom/2)-(g_DIBFade.dwHeight/2),					(g_rcArray[GR_SCREEN].right/2)+(g_DIBFade.dwWidth/2),				(g_rcArray[GR_SCREEN].bottom/2)+(g_DIBFade.dwHeight/2) );				for( i=0;i<4;i++ ){			CopyRect( &g_rcArray[GR_MODEB_GUIDE_A+i],&g_rcArray[GR_MODEB] );			g_rcArray[GR_MODEB_GUIDE_A+i].left+=38/*50*/;			g_rcArray[GR_MODEB_GUIDE_A+i].top+=10/*8*/;			AdjustRect( g_hWnd,GetFont(GF_MODEB_GUIDE),GetRectangle(GR_MODEB_GUIDE_A+i),								GetString(GS_MODEB_GUIDE_A+i),AR_LEFT|AR_MIDDLE);			OffsetRect( &g_rcArray[GR_MODEB_GUIDE_A+i],0,(GetFontHeight(GF_MODEB_GUIDE)+10)*i );		}					//Begin ModeA		SetRect( &g_rcArray[GR_MODEA_YEAR],				g_rcArray[GR_SCREEN].left,				(g_rcArray[GR_SCREEN].bottom/2)-(GetFontHeight(GF_MODEA_YEAR)/2),					g_rcArray[GR_SCREEN].right,				(g_rcArray[GR_SCREEN].bottom/2)+GetFontHeight(GF_MODEA_YEAR)/2+						GetFontHeight(GF_MODEA_YEAR)%2 );				SetRect( &g_rcArray[GR_MODEA_NAME],				g_rcArray[GR_SCREEN].left,				(g_rcArray[GR_SCREEN].bottom/2)-(GetFontHeight(GF_MODEA_NAME)/2),					g_rcArray[GR_SCREEN].right,				(g_rcArray[GR_SCREEN].bottom/2)				+(GetFontHeight(GF_MODEA_NAME)/2)+(GetFontHeight(GF_MODEA_NAME)%2) );				OffsetRect( &g_rcArray[GR_MODEA_YEAR],0,-1*(GetFontHeight(GF_MODEA_NAME)) );		SetRect( &g_rcArray[GR_MODEA],			min( g_rcArray[GR_MODEA_YEAR].left,g_rcArray[GR_MODEA_NAME].left ),			min( g_rcArray[GR_MODEA_YEAR].top,g_rcArray[GR_MODEA_NAME].top ),			max( g_rcArray[GR_MODEA_YEAR].right,g_rcArray[GR_MODEA_NAME].right ),			max( g_rcArray[GR_MODEA_YEAR].bottom,g_rcArray[GR_MODEA_NAME].bottom ) );			//	ReleaseDC( g_hWnd,hDC );				//ModeC		CopyRect( &g_rcArray[GR_MODEC],&g_rcArray[GR_SCREEN] );		SetRect( &g_rcArray[GR_MODEC_A],				g_rcArray[GR_MODEC].left,g_rcArray[GR_MODEC].top+GetFontHeight(GF_MODEC_C),				g_rcArray[GR_MODEC].right,g_rcArray[GR_MODEC].top+GetFontHeight(GF_MODEC_C)+GetFontHeight(GF_MODEC_A));				offx = (g_rcArray[GR_MODEC].right-g_rcArray[GR_MODEC].left)/2;				SetRect( &g_rcArray[GR_MODEC_C],				g_rcArray[GR_MODEC].left,				g_rcArray[GR_MODEC].bottom-GetFontHeight(GF_MODEC_C)*3,				g_rcArray[GR_MODEC].right,				g_rcArray[GR_MODEC].bottom-GetFontHeight(GF_MODEC_C)*2);									SetRect( &g_rcArray[GR_MODEC_PREV],				g_rcArray[GR_MODEC].left+5,				g_rcArray[GR_MODEC_A].bottom+1,				g_rcArray[GR_MODEC].left+offx,				g_rcArray[GR_MODEC_A].bottom+GetFontHeight(GF_MODEC_D));						SetRect( &g_rcArray[GR_MODEC_NEXT],				g_rcArray[GR_MODEC_PREV].right,				g_rcArray[GR_MODEC_A].bottom+1,				g_rcArray[GR_MODEC].right-5,				g_rcArray[GR_MODEC_A].bottom+GetFontHeight(GF_MODEC_D));				SetRect( &g_rcArray[GR_MODEC_B],				g_rcArray[GR_MODEC].left,				g_rcArray[GR_MODEC_NEXT].bottom+GetFontHeight(GF_MODEC_B),				g_rcArray[GR_MODEC].left+offx,				g_rcArray[GR_MODEC_NEXT].bottom+GetFontHeight(GF_MODEC_B)*2);			//ModeE		CopyRect( &g_rcArray[GR_MODEE],&g_rcArray[GR_SCREEN] );		CopyRect( &g_rcArray[GR_MODEE_A],&g_rcArray[GR_MODEC_A] ); //タイトルは同じ							SetRect( &g_rcArray[GR_MODEE_C],				g_rcArray[GR_MODEE].left,				g_rcArray[GR_MODEE_A].bottom+GetFontHeight(GF_MODEC_B),				g_rcArray[GR_MODEE].left+(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,				g_rcArray[GR_MODEE_A].bottom+GetFontHeight(GF_MODEC_B)*2);						SetRect( &g_rcArray[GR_MODEE_B],				g_rcArray[GR_MODEE].left,				g_rcArray[GR_MODEE].bottom-GetFontHeight(GF_MODEC_B)*2,				g_rcArray[GR_MODEE].right,				g_rcArray[GR_MODEE].bottom-GetFontHeight(GF_MODEC_B));						AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_C),GetString(GS_MODEE_C),AR_CENTER);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_B),GetString(GS_MODEE_B),AR_CENTER);						SetRect( &g_rcArray[GR_MODEE_UP],(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,										g_rcArray[GR_MODEE_A].bottom+GetFontHeight( GF_MSMIN_SMALL ),										(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3*2,										g_rcArray[GR_MODEE_A].bottom+GetFontHeight( GF_MSMIN_SMALL )*2 );		AdjustRect( g_hWnd,GetFont(GF_MSMIN_SMALL),GetRectangle(GR_MODEE_UP),GetString(GS_MODEE_UP),AR_RIGHT|AR_BOTTOM);				SetRect( &g_rcArray[GR_MODEE_NUMBER],(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,										g_rcArray[GR_MODEE_UP].bottom+2,										(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3*2,										g_rcArray[GR_MODEE_UP].bottom+2+GetFontHeight( GF_MODEC_B ) );		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_NUMBER),GetString(GS_MODEE_ZERO),AR_RIGHT|AR_MIDDLE);		g_rcArray[GR_MODEE_UP].left = g_rcArray[GR_MODEE_NUMBER].left;		g_rcArray[GR_MODEE_UP].right = g_rcArray[GR_MODEE_NUMBER].right;		AdjustRect( g_hWnd,GetFont(GF_MSMIN_SMALL),GetRectangle(GR_MODEE_UP),GetString(GS_MODEE_UP),AR_CENTER|AR_BOTTOM);				SetRect( &g_rcArray[GR_MODEE_DOWN],g_rcArray[GR_MODEE_NUMBER].left,										g_rcArray[GR_MODEE_NUMBER].bottom+2,										g_rcArray[GR_MODEE_NUMBER].right,										g_rcArray[GR_MODEE_NUMBER].bottom+2+GetFontHeight( GF_MSMIN_SMALL ) );		AdjustRect( g_hWnd,GetFont(GF_MSMIN_SMALL),GetRectangle(GR_MODEE_DOWN),GetString(GS_MODEE_DOWN),AR_CENTER|AR_TOP);				SetRect( &g_rcArray[GR_MODEE_D],				g_rcArray[GR_MODEE].left,				g_rcArray[GR_MODEE_DOWN].bottom+5,				g_rcArray[GR_MODEE].right,				g_rcArray[GR_MODEE_DOWN].bottom+5+GetFontHeight(GF_MODEC_C));				SetRect( &g_rcArray[GR_MODEE_F],				g_rcArray[GR_MODEE].left,				g_rcArray[GR_MODEE_D].bottom+GetFontHeight(GF_MODEC_B),				g_rcArray[GR_MODEE].left+(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,				g_rcArray[GR_MODEE_D].bottom+GetFontHeight(GF_MODEC_B)*2);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_F),GetString(GS_MODEE_F),AR_CENTER);						SetRect( &g_rcArray[GR_MODEE_STAR],				g_rcArray[GR_MODEE].left+(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,				g_rcArray[GR_MODEE_D].bottom+GetFontHeight(GF_MODEC_B),				(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3*2,				g_rcArray[GR_MODEE_D].bottom+GetFontHeight(GF_MODEC_B)*2);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_STAR),GetString(GS_MODEE_STARMAX),AR_CENTER);		g_rcArray[GR_MODEE_J].right=g_rcArray[GR_MODEE_STAR].right;		g_rcArray[GR_MODEE_I].right=g_rcArray[GR_MODEE_STAR].right;				AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_STAR),GetString(GS_MODEE_STAR),AR_LEFT);		g_rcArray[GR_MODEE_I].left=g_rcArray[GR_MODEE_STAR].left;		g_rcArray[GR_MODEE_J].left=g_rcArray[GR_MODEE_STAR].left;				SetRect( &g_rcArray[GR_MODEE_G],				g_rcArray[GR_MODEE_STAR].left,				g_rcArray[GR_MODEE_STAR].bottom+5,				g_rcArray[GR_MODEE].right,				g_rcArray[GR_MODEE_STAR].bottom+5+GetFontHeight(GF_MODEC_C));		AdjustRect( g_hWnd,GetFont(GF_MODEC_C),GetRectangle(GR_MODEE_G),GetString(GS_MODEE_EASY),AR_LEFT);				g_rcArray[GR_MODEE_H].left = g_rcArray[GR_MODEE_F].left;		g_rcArray[GR_MODEE_H].right = g_rcArray[GR_MODEE].left+(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3;		g_rcArray[GR_MODEE_H].top = g_rcArray[GR_MODEE_G].bottom+GetFontHeight(GF_MODEC_B);		g_rcArray[GR_MODEE_H].bottom = g_rcArray[GR_MODEE_H].top+GetFontHeight(GF_MODEC_B);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_H),GetString(GS_MODEE_H),AR_LEFT);						g_rcArray[GR_MODEE_I].top = g_rcArray[GR_MODEE_H].top;		g_rcArray[GR_MODEE_I].bottom = g_rcArray[GR_MODEE_I].top+GetFontHeight(GF_STATUS);		g_rcArray[GR_MODEE_J].top = g_rcArray[GR_MODEE_H].top;		g_rcArray[GR_MODEE_J].bottom = g_rcArray[GR_MODEE_I].top+GetFontHeight(GF_STATUS);		AdjustRect( g_hWnd,GetFont(GF_STATUS),GetRectangle(GR_MODEE_I),GetString(GS_MODEE_I),AR_LEFT|AR_TOP);		AdjustRect( g_hWnd,GetFont(GF_STATUS),GetRectangle(GR_MODEE_J),GetString(GS_MODEE_J),AR_RIGHT|AR_TOP);				SetRect( &g_rcArray[GR_MODEE_K],				g_rcArray[GR_MODEE].left,				g_rcArray[GR_MODEE_H].bottom+GetFontHeight(GF_MODEC_B),				g_rcArray[GR_MODEE].left+(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3,				g_rcArray[GR_MODEE_H].bottom+GetFontHeight(GF_MODEC_B)*2);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_K),GetString(GS_MODEE_K),AR_CENTER);						CopyRect( &g_rcArray[GR_MODEE_L],&g_rcArray[GR_MODEE_K] );		CopyRect( &g_rcArray[GR_MODEE_M],&g_rcArray[GR_MODEE_K] );		g_rcArray[GR_MODEE_L].left=g_rcArray[GR_MODEE_I].left;		g_rcArray[GR_MODEE_M].left=g_rcArray[GR_MODEE_I].left;				g_rcArray[GR_MODEE_L].right=g_rcArray[GR_MODEE_J].right;		g_rcArray[GR_MODEE_M].right=g_rcArray[GR_MODEE_J].right;		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_L),GetString(GS_MODEE_L),AR_LEFT);		AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEE_M),GetString(GS_MODEE_M),AR_RIGHT);						SetRect( &g_rcArray[GR_MODEE_E],				(g_rcArray[GR_MODEE].right-g_rcArray[GR_MODEE].left)/3*2,				g_rcArray[GR_MODEE_NUMBER].top,				g_rcArray[GR_MODEE].right,				g_rcArray[GR_MODEE_NUMBER].top+GetFontHeight(GF_MODEC_B));				//ModeF		CopyRect( &g_rcArray[GR_MODEF],&g_rcArray[GR_SCREEN] );		CopyRect( &g_rcArray[GR_MODEF_A],&g_rcArray[GR_MODEC_A] ); //タイトルは同じ							SetRect( &g_rcArray[GR_MODEF_B],				g_rcArray[GR_MODEF].left,				g_rcArray[GR_MODEF].bottom-GetFontHeight(GF_MODEC_B)*2,				g_rcArray[GR_MODEF].right,				g_rcArray[GR_MODEF].bottom-GetFontHeight(GF_MODEC_B));						AdjustRect( g_hWnd,GetFont(GF_MODEC_B),GetRectangle(GR_MODEF_B),GetString(GS_MODEF_B),AR_CENTER);					SetRect( &g_rcArray[GR_MODEF_C],				g_rcArray[GR_MODEF].left+80,				g_rcArray[GR_MODEF_A].bottom+GetFontHeight(GF_TIMES_SMALL),				(g_rcArray[GR_MODEF].right-g_rcArray[GR_MODEF].left)/2,				g_rcArray[GR_MODEF_A].bottom+GetFontHeight(GF_TIMES_SMALL)*2);						SetRect( &g_rcArray[GR_MODEF_D],				g_rcArray[GR_MODEF_C].right,				g_rcArray[GR_MODEF_A].bottom+GetFontHeight(GF_TIMES_SMALL),				g_rcArray[GR_MODEF].right-80,				g_rcArray[GR_MODEF_A].bottom+GetFontHeight(GF_TIMES_SMALL)*2);										//ModeG		CopyRect( &g_rcArray[GR_MODEG],&g_rcArray[GR_SCREEN] );		CopyRect( &g_rcArray[GR_MODEG_A],&g_rcArray[GR_MODEC_A] ); //タイトルは同じ			CopyRect( &g_rcArray[GR_MODEG_B],&g_rcArray[GR_MODEF_B] );				SetRect( &g_rcArray[GR_MODEG_C],				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL),				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5*2,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL)*2);						SetRect( &g_rcArray[GR_MODEG_D],				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5*2,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL),				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5*3,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL)*2);		//AdjustRect( g_hWnd,GetFont(GF_TIMES_SMALL),GetRectangle(GR_MODEG_D),"WWW",AR_CENTER);									SetRect( &g_rcArray[GR_MODEG_E],				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5*3,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL),				(g_rcArray[GR_MODEG].right-g_rcArray[GR_MODEG].left)/5*4,				g_rcArray[GR_MODEG_A].bottom+GetFontHeight(GF_TIMES_SMALL)*2);		}LPRECT GetRectangle( UINT uRectID ){	return (LPRECT)(&g_rcArray[uRectID] );		}VOID PlayAppSound( UINT id ){	if( g_lpSoundArray[id]  && g_GameOption.bVoiceOn )		PlaySound( (const char*)g_lpSoundArray[id],NULL,SND_MEMORY|SND_ASYNC|SND_NODEFAULT );}//DIBFadeLPDIBFADE GetDIBFade( VOID ){	return (LPDIBFADE)(&g_DIBFade);}//SSTALPSSTA	GetSSTA( VOID ){	return (LPSSTA)&g_SSTA;}LPSTR GetString( UINT uStringID ){	return g_str[uStringID];}ERRCODE LoadGameOption( VOID ){	HKEY hKey;	DWORD dwDisp;	LONG lResult = RegCreateKeyEx( HKEY_USERS,GetString(GS_REG_KEY),						0,"",REG_OPTION_NON_VOLATILE,						KEY_ALL_ACCESS,NULL,						&hKey,&dwDisp );	/* CHANGE 01/01/29 	* Windows2000の一般ユーザはレジストリ操作ができない	*/	if( lResult != ERROR_SUCCESS ){		SetDefaultOption();		return ERR_NOTHING;	}		if( dwDisp == REG_CREATED_NEW_KEY ){		SetDefaultOption();	}	else{		DWORD dwType = REG_BINARY;		DWORD dwBytes = sizeof( GAMEOPTION );		lResult = RegQueryValueEx( hKey,GetString(GS_REG_VALUE),0,&dwType,(LPBYTE)&g_GameOption,&dwBytes );		if( lResult != ERROR_SUCCESS )			SetDefaultOption();		g_GameOption.dwNoruma = min( g_GameOption.dwNoruma,GetSSTA()->dwTotalOfElement );	}	RegCloseKey( hKey );		g_bLoadOK = TRUE;		return ERR_NOTHING;}ERRCODE SaveGameOption( VOID ){	HKEY hKey;	DWORD dwDisp;	DWORD dwType = REG_BINARY;	DWORD dwBytes = sizeof( GAMEOPTION );	LONG lResult;		if( !g_bLoadOK )		return ERR_NOTHING;		lResult = RegCreateKeyEx( HKEY_USERS,GetString(GS_REG_KEY),						0,"",REG_OPTION_NON_VOLATILE,						KEY_ALL_ACCESS,NULL,						&hKey,&dwDisp );	if( lResult != ERROR_SUCCESS )		return ERR_SYSTEM;		if( !g_GameOption.bScoreSave ){ //ハイスコアの破棄		SetDefaultScore();	}		//書き出し	RegSetValueEx( hKey,GetString(GS_REG_VALUE),0,dwType,(LPBYTE)&g_GameOption,dwBytes );	RegCloseKey( hKey );		return ERR_NOTHING;}VOID SetDefaultOption( VOID ){	g_GameOption.dwNoruma = min( 50,GetSSTA()->dwTotalOfElement 	);	g_GameOption.wDifficulty	= 4;	g_GameOption.bVoiceOn = TRUE;	g_GameOption.bScoreSave = TRUE;	SetDefaultScore();}VOID SetDefaultScore( VOID ){//	LPSTR strNames[]={"SOL","KY ","JAM","MAY","AXL","DIZ","TST","ZAT","ANJ","FST"};//	DWORD dwScore=10000;//	INT i;	SCOREDATA sd[10]={		{50000,"SOL",5,TRUE,0,200,200,5000,400," 6.00",0},	{40000,"KY ",5,FALSE,0,200,150,5000,800," 5.50",0},	{30000,"JAM",4,TRUE,0,150,150,3500,500," 5.00",0},	{25000,"MAY",4,FALSE,0,150,100,3500,600," 4.80",0},	{20000,"AXL",3,TRUE,0,120,120,3000,600," 4.40",0},	{15000,"DIZ",3,FALSE,0,120,80,3000,700," 4.00",0},	{10000,"TST",2,TRUE,0,100,100,2000,500," 3.80",0},	{8000,"ZAT",2,FALSE,0,100,50,2000,800," 3.40",0},	{4000,"ANJ",1,TRUE,0,50,50,1000,200," 3.00",0},	{2000,"FST",1,FALSE,0,50,20,1000,300," 2.50",0}		};	CopyMemory( &g_GameOption.sd,&sd,sizeof(sd) );/*	for( i=0;i<10;i++ ){		g_GameOption.sd[i].dwScore = dwScore;		lstrcpy( g_GameOption.sd[i].cName,strNames[i] );		dwScore -= 1000;	}*/} LPGAMEOPTION GetGameOption( VOID ) { 	return (LPGAMEOPTION)&g_GameOption; }  VOID ShiftScoreData( INT iRank ) { 	INT index = iRank-1; 	INT i;  	for( i=8;i>=index;i-- ){ 		CopyMemory( &(g_GameOption.sd[i+1]),&(g_GameOption.sd[i]),sizeof(SCOREDATA) ); 	}}